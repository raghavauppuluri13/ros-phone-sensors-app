{"version":3,"sources":["scripts/camera_imu.ts","App.js","reportWebVitals.js","index.js"],"names":["CameraIMU","ros_master_ip","ros","alpha","valpha","z","beta","vbeta","x","gamma","vgamma","y","image_topic","imu_topic","this","ROSLIB","Ros","url","on","console","log","error","window","alert","Topic","name","messageType","initialize_event_handlers","location","protocol","href","substring","length","DeviceOrientationEvent","requestPermission","then","response","addEventListener","eventData","catch","DeviceMotionEvent","acceleration","rotation","rotationRate","getImageCb","imageMessage","Message","format","data","replace","publish","beta_radian","Math","PI","gamma_radian","alpha_radian","eurlerpose","THREE","quaternionpose","setFromEuler","imuMessage","header","frame_id","orientation","w","orientation_covariance","angular_velocity","angular_velocity_covariance","linear_acceleration","linear_acceleration_covariance","setInterval","imageSnapshot","imuSnapshot","App","useState","localStorage","getItem","rosMasterIp","setRosMasterIp","frontFacing","setFrontFacing","width","screen","height","outputDims","videoConstraints","facingMode","exact","webcamRef","useRef","current","getScreenshot","style","padding","onChange","event","setItem","target","value","onClick","start","type","audio","ref","screenshotFormat","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.f3f5d11a.chunk.js","sourcesContent":["import ROSLIB from \"roslib\";\nimport * as THREE from \"three\";\n\nclass CameraIMU {\n  ros: ROSLIB.Ros;\n  alpha: number | null;\n  valpha: number | null;\n  z: number | null;\n  beta: number | null;\n  vbeta: number | null;\n  x: number | null;\n  gamma: number | null;\n  vgamma: number | null;\n  y: number | null;\n  image_topic: ROSLIB.Topic;\n  imu_topic: ROSLIB.Topic;\n\n  constructor(ros_master_ip: string) {\n    ros_master_ip = \"wss://\" + ros_master_ip + \":9090\"\n    // INITIALIZATION\n    this.ros = new ROSLIB.Ros({\n      url: ros_master_ip\n    });\n\n    this.ros.on('connection', function () { console.log('Connected to websocket server.'); });\n\n    this.ros.on('error', function (error) { console.log('Error connecting to websocket server: ', error); window.alert('Error connecting to websocket server'); });\n\n    this.ros.on('close', function () { console.log('Connection to websocket server closed.'); });\n\n    this.alpha = null;\n    this.valpha = null;\n    this.z = null;\n    this.beta = null;\n    this.vbeta = null;\n    this.x = null;\n    this.gamma = null;\n    this.vgamma = null;\n    this.y = null;\n\n    this.image_topic = new ROSLIB.Topic({\n      ros: this.ros,\n      name: \"/camera/image/compressed\",\n      messageType: \"sensor_msgs/CompressedImage\",\n    });\n\n    this.imu_topic = new ROSLIB.Topic({\n      ros: this.ros,\n      name: \"/gyro\",\n      messageType: \"sensor_msgs/Imu\",\n    });\n    this.initialize_event_handlers();\n  }\n\n  initialize_event_handlers() {\n    if (window.location.protocol != \"https:\") {\n      window.location.href = \"https:\" + window.location.href.substring(window.location.protocol.length);\n    }\n\n    if (typeof (DeviceOrientationEvent) !== \"undefined\" && typeof (DeviceOrientationEvent.requestPermission) === \"function\") {\n      // (optional) Do something before API request prompt.\n      DeviceOrientationEvent.requestPermission()\n        .then(response => {\n          // (optional) Do something after API prompt dismissed.\n          if (response == \"granted\") {\n            window.addEventListener(\"deviceorientation\", (eventData) => {\n              // gamma is the left-to-right tilt in degrees, where right is positive\n              this.gamma = eventData.gamma;\n\n              // beta is the front-to-back tilt in degrees, where front is positive\n              this.beta = eventData.beta;\n\n              // alpha is the compass direction the device is facing in degrees\n              this.alpha = eventData.alpha\n            }, false)\n          }\n        })\n        .catch(console.error)\n    } else {\n      alert(\"DeviceOrientationEvent is not defined\");\n    }\n\n    if (typeof (DeviceMotionEvent) !== \"undefined\" && typeof (DeviceMotionEvent.requestPermission) === \"function\") {\n      // (optional) Do something before API request prompt.\n      DeviceMotionEvent.requestPermission()\n        .then(response => {\n          // (optional) Do something after API prompt dismissed.\n          if (response == \"granted\") {\n            window.addEventListener(\"devicemotion\", (eventData) => {\n              // Grab the acceleration from the results\n              var acceleration = eventData.acceleration;\n              this.x = acceleration!.x;\n              this.y = acceleration!.y;\n              this.z = acceleration!.z;\n\n              // Grab the rotation rate from the results\n              var rotation = eventData.rotationRate;\n              this.valpha = rotation!.alpha;\n              this.vgamma = rotation!.gamma;\n              this.vbeta = rotation!.beta;\n            }, false)\n          }\n        })\n        .catch(console.error)\n    } else {\n      alert(\"DeviceMotionEvent is not defined\");\n    }\n  }\n  // function that is run by trigger several times a second\n  // takes snapshot of video to canvas, encodes the images as base 64 and sends it to the ROS topic\n  imageSnapshot(getImageCb: () => string) {\n    var imageMessage = new ROSLIB.Message({\n      format: \"jpeg\",\n      data: getImageCb().replace(\"data:image/jpeg;base64,\", \"\")\n    });\n\n    this.image_topic.publish(imageMessage);\n  }\n\n  imuSnapshot() {\n    var beta_radian = ((this.beta! + 360) / 360 * 2 * Math.PI) % (2 * Math.PI);\n    var gamma_radian = ((this.gamma! + 360) / 360 * 2 * Math.PI) % (2 * Math.PI);\n    var alpha_radian = ((this.alpha! + 360) / 360 * 2 * Math.PI) % (2 * Math.PI);\n    var eurlerpose = new THREE.Euler(beta_radian, gamma_radian, alpha_radian);\n    var quaternionpose = new THREE.Quaternion;\n    quaternionpose.setFromEuler(eurlerpose);\n\n    var imuMessage = new ROSLIB.Message({\n      header: {\n        frame_id: \"world\"\n      },\n      orientation: {\n        x: quaternionpose.x,\n        y: quaternionpose.y,\n        z: quaternionpose.z,\n        w: quaternionpose.w\n      },\n      orientation_covariance: [0, 0, 0, 0, 0, 0, 0, 0, 0],\n      angular_velocity: {\n        x: this.vbeta,\n        y: this.vgamma,\n        z: this.valpha,\n      },\n      angular_velocity_covariance: [0, 0, 0, 0, 0, 0, 0, 0, 0],\n      linear_acceleration: {\n        x: this.x,\n        y: this.y,\n        z: this.z,\n      },\n      linear_acceleration_covariance: [0, 0, 0, 0, 0, 0, 0, 0, 0],\n    });\n\n    this.imu_topic.publish(imuMessage);\n  }\n\n  start(getImageCb: () => string) {\n    setInterval(() => {\n      this.imageSnapshot(getImageCb);\n    }, 250);       // publish an image 4 times per second\n    setInterval(() => {\n      this.imuSnapshot();\n    }, 100);       // publish an IMU message 10 times per second\n  }\n}\n\nexport default CameraIMU;","import { useRef, useState } from \"react\";\nimport Webcam from \"react-webcam\";\nimport CameraIMU from \"./scripts/camera_imu.ts\";\n\nfunction App() {\n  const [rosMasterIp, setRosMasterIp] = useState(\n    localStorage.getItem(\"rosMasterIp\") | \"\"\n  );\n  const [frontFacing, setFrontFacing] = useState(\n    localStorage.getItem(\"frontFacing\") | true\n  );\n\n  var camera_imu;\n  const padding = 10;\n  const width = window.screen.width - 2 * padding;\n  const height = window.screen.height * 0.65;\n  const outputDims = { width: 1920, height: 1080 };\n\n  var videoConstraints = {\n    width: width,\n    height: height,\n    facingMode: frontFacing ? \"user\" : { exact: \"environment\" },\n  };\n\n  const onRosIpChange = (event) => {\n    localStorage.setItem(\"rosMasterIp\", event.target.value);\n    setRosMasterIp(event.target.value);\n  };\n\n  const onCameraDirChange = () => {\n    localStorage.setItem(\"frontFacing\", !frontFacing);\n    setFrontFacing(!frontFacing);\n  };\n\n  const webcamRef = useRef(null);\n\n  const getImageCb = () => {\n    if (webcamRef) {\n      return webcamRef.current.getScreenshot(outputDims);\n    }\n  };\n\n  const initCameraIMU = () => {\n    camera_imu = new CameraIMU(rosMasterIp);\n    camera_imu.start(getImageCb);\n  };\n\n  return (\n    <div style={{ padding: `${padding}px` }}>\n      <label>ROS Master IP Address:</label>\n      <input onChange={onRosIpChange} value={rosMasterIp}/>\n      <br />\n      <br />\n      <button onClick={() => initCameraIMU()}>Initialize</button>\n      <br />\n      <br />\n      <label>Front Facing Camera? </label>\n      <input onChange={onCameraDirChange} value={frontFacing} type=\"checkbox\" />\n      <div>\n        \n      </div>\n      <Webcam\n        audio={false}\n        height={height}\n        ref={webcamRef}\n        screenshotFormat=\"image/jpeg\"\n        width={width}\n        videoConstraints={videoConstraints}\n      />\n    </div>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}